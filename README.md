# Google Calendar to Discord Notifier

## はじめに

このツールは、Google Apps Script (GAS) を利用して、公開されている Google カレンダーの予定を Discord に自動的に通知するスクリプトです。指定したカレンダーのイベント情報を定期的に取得し、その日の昼間と夜間の予定状況を分かりやすく Discord のチャンネルへ送信します。

**こんな方におすすめ:**

* Googleカレンダーの予定をDiscordのメッセージとして共有したい方
* チームやメンバーと静かに予定の空き状況を共有したい方
* 複数カレンダーの予定をまとめてDiscordに通知したい方

**特徴:**

* **複数カレンダー対応:** 複数の Google カレンダーの ID を指定して監視できます。
* **祝日対応:** 日本の祝日カレンダー（または指定した休日カレンダー）を考慮し、祝日には「予定なし」と判定できます。
* **出勤予定対応:** 平日の日中など、あらかじめ設定した時間帯を「予定あり」とみなすことができます。
* **柔軟な時間帯設定:** 昼間と夜間の時間帯を自由に設定できます。
* **空き時間可視化:** イベント間の空き時間が一定時間以上ある場合、「△」（要相談）として表示し、調整の余地を示唆します。
* **期間設定:** 当月を含む前後数ヶ月の予定情報をまとめて送信できます。
* **埋め込み表示:** Discord に送信するメッセージは見やすい埋め込み形式です。
* **メッセージ更新:** 初回投稿後、定期的に同じメッセージを編集して更新するため、スパムのような大量の通知を防ぎます。
* **サイレント通知:** `@silent` フラグにより、Discord の通知音を鳴らさずにメッセージを送信できます。

**メッセージの例:**

![メッセージの例](https://github.com/murahito130/Google-Calendar-to-Discord-Notifier/blob/main/example.png)

### 注意点

* 初期設定では、制作者の生活サイクルに基づいた時間帯設定（昼：12時～18時、夜：20時～翌1時）と、平日の日中は予定があり、土日祝日は予定が空いているという前提で動作します。ご自身の生活サイクルに合わせて、設定をカスタマイズしてください。
* スクリプトの実行には、Google カレンダーと Discord へのアクセス許可が必要です。

## 設定項目

スクリプトの先頭にある以下の定数を、ご自身の環境に合わせて設定してください。

* `CALENDAR_IDS`: **必須** 監視したい Google カレンダーの ID を配列形式で指定します。
    * 例: `['your_primary_email@gmail.com', 'shared_calendar_id@group.calendar.google.com']`
* `DISCORD_WEBHOOK_URL`: **必須** Discord の Webhook URL を指定します。
    * Webhook の作成方法は [Discord Developer Portal](https://discord.com/developers/docs/resources/webhook) を参照してください。
* `HOLIDAY_CALENDAR_IDS`: 祝日カレンダーの ID の配列です。
    * デフォルト: `['ja.japanese#holiday@group.v.calendar.google.com']` (日本の祝日) 
    * 他の国の祝日カレンダーを追加することも可能です。
* `MESSAGE_ID_CACHE_KEY`: Discord に送信したメッセージの ID を保存するためのキーです。通常は変更不要です。
* `NUM_OF_MONTHS`: 処理対象とする月数です。
    * 例: `3` (当月、翌月、翌々月)
* `WEEK_DAYS`: 曜日を表示するための配列です。通常は変更不要です。
    * 例: `['日', '月', '火', '水', '木', '金', '土']`
* `DAYTIME_START_HOUR`: 昼間の時間帯の開始時間（時）を 0〜23 の整数で指定します。
    * 例: `12`
* `DAYTIME_END_HOUR`: 昼間の時間帯の終了時間（時）を 0〜23 の整数で指定します。
    * 例: `18`
* `NIGHTTIME_START_HOUR`: 夜間の時間帯の開始時間（時）を 0〜23 の整数で指定します。
    * 例: `20`
* `NIGHTTIME_END_HOUR`: 夜間の時間帯の終了時間（時）を 0〜23 の整数で指定します。
    * 23 を超える値を指定すると、翌日の時間として扱われます。（例：`25` は翌日の 1 時）
    * 例: `25`
* `MIN_GAP_HOURS`: イベントとイベントの間、または時間帯の開始・終了とイベントの間に、この時間以上の空き時間がある場合に、その時間帯のステータスを「△」とします。
    * 例: `3` (3時間以上の空き時間)
* `PROCESSING_INTERVAL_MINUTES`: イベントの有無を判定する際の時間間隔（分）です。この間隔で区切って予定の有無を確認します。
    * 例: `30` (30分間隔)
* `WORK_SCHEDULES`: 休日・祝日ではない日に、予定が入っているとみなしたい時間帯を設定します。
    * 配列形式で、各要素は `{ dayOfWeek: 曜日 (0:日, 1:月, ..., 6:土), startTime: 開始時間 (時), endTime: 終了時間 (時), ignoreOnHoliday: 祝日の場合でもこの予定を適用するかどうか (true: 適用する, false: 適用しない), startDate: 開始日 (Date型, オプション), endDate: 終了日 (Date型, オプション) }` のオブジェクトです。
    * 例:
        * `[new WorkSchedule(1, 9, 19), new WorkSchedule(2, 9, 19)]` (月曜と火曜の 9時〜19時)
        * `[new WorkSchedule(1, 9, 19, false, new Date('2025-05-10'), new Date('2025-05-15'))]` (2025年5月10日〜2025年5月15日の月曜日 9時〜19時、祝日は休み)

## セットアップ手順

1.  **Google Apps Script エディタを開く:**
    * Google Drive にアクセスし、「新規」 > 「その他」 > 「Google Apps Script」を選択します。
    * または、以下の URL にアクセスします: [https://script.google.com/](https://script.google.com/)
2.  **コードをコピー＆ペースト:**
    * この README に記載されている GAS のコード全体をコピーし、Apps Script エディタに貼り付けます。既存のコードはすべて削除してください。
3.  **設定を編集:**
    * スクリプトの冒頭にある設定項目 (`CALENDAR_IDS`, `DISCORD_WEBHOOK_URL` など) を、ご自身の環境に合わせて正確に編集してください。特に、`CALENDAR_IDS` と `DISCORD_WEBHOOK_URL` の設定は必須です。
4.  **権限の承認:**
    * 初めてスクリプトを実行する際、Google カレンダーへのアクセス許可を求められます。「許可を確認」をクリックし、Google アカウントを選択して、必要な権限を承認してください。
5.  **トリガーの設定 (推奨):**
    * スクリプトを定期的に自動実行するために、トリガーを設定します。
    * Apps Script エディタの左側にある時計のアイコン（トリガー）をクリックします。
    * 右下の「トリガーを追加」ボタンをクリックします。
    * 「実行する関数を選択」で `sendCalendarEventsToDiscord` を選択します。
    * 「イベントソースを選択」で「時間主導型」を選択します。
    * 「時間ベースのトリガーのタイプを選択」で、実行したい頻度を選択します。（例: 「30分ごと」、「1時間ごと」、「4時間ごと」など。4時間以内を推奨します。）
    * 必要に応じて他の設定を行い、「保存」をクリックします。

## その他の注意点

* **Webhook URL の管理:** Discord の Webhook URL は機密情報です。第三者に漏洩しないよう、安全に管理してください。
* **実行頻度:** スクリプトの実行頻度が高すぎると、Google Apps Script の実行制限に達する可能性がありますのでご注意ください。トリガーの設定は、必要な頻度と Google Apps Script の制限を考慮して行ってください。
* **カレンダーの公開設定:** 監視対象の Google カレンダーのイベント公開設定によっては、意図しない情報が Discord に送信される可能性があります。カレンダーのイベント設定を事前に確認してください。
* **スクリプトのカスタマイズ:** ご自身の生活サイクルや通知したい情報に合わせて、スクリプトを自由にカスタマイズしてください。

このスクリプトを活用することで、Google カレンダーの予定を Discord でスムーズに共有し、より効率的な情報共有とコミュニケーションを実現できます。
