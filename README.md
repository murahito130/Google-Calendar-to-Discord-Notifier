# はじめに

GAS（Google Apps Script）を使用して公開されている Google カレンダーのカレンダーIDと Discord の Webhook URL を指定することで、以下のようなメッセージを Discord に送信できます。<br>
このコードを GAS のトリガーを使用して数時間（4時間以内を推奨）ごとに実行することで、同じメッセージを編集する形でメッセージを更新できますので、Discordの新規メッセージの通知を煩わしく思う方におすすめです。

![メッセージの例](https://github.com/murahito130/google_calendar_freebusy_discord_webhook/blob/main/example.png)

### 注意
初期のコードは、制作者の生活サイクルを想定してプログラムされています。<br>
具体的には以下の通り<br>
- 12時から18時を昼とする
- 20時から25時を夜とする
- 平日の日中（昼）は予定がある
- 土日祝日は予定が空いている

制作者と生活サイクルが異なる方や、設定の変更を希望される方は、ご自由にカスタマイズしてください。

# Google Calendar to Discord Notifier

このGoogle Apps Script（GAS）は、指定したGoogleカレンダーの予定に基づいて、Discordに日ごとの空き状況を通知します。祝日や指定した出勤予定も考慮し、昼間と夜間のステータスを分かりやすく表示します。

## 機能

- 複数のGoogleカレンダーを監視し、予定を取得します。
- 日本の祝日カレンダー（`ja.japanese#holiday@group.v.calendar.google.com`）を含む、複数の休日カレンダーに対応しています。
- 設定された出勤予定（曜日、開始・終了時間）に基づいて、平日の昼間のステータスを「予定あり」と判定します。
- 昼間（デフォルト: 12時〜18時）と夜間（デフォルト: 20時〜翌1時）の空き状況を「◯」（空き）、「△」（要相談 - 長時間空きあり）、「✕」（予定あり）の3つのステータスで表示します。
- 終日の予定がある日は、昼夜ともに「△」と表示します。
- 設定された最小の空き時間（デフォルト: 3時間）がある場合、「△」と表示します。
- DiscordのWebhook URLを設定することで、指定のチャンネルに通知を送信します。
- 直近3ヶ月の空き状況をまとめてDiscordに投稿します。
- 初回投稿後は、定期実行時にメッセージを編集して更新します（メッセージIDをキャッシュに保存）。
- `@silent`フラグにより、通知音なしで投稿します。

## セットアップ

1. **Google Apps Scriptの作成:**
   - Google Driveを開き、「新規」 > 「その他」 > 「Google Apps Script」を選択して、新しいスクリプトファイルを作成します。
   - スクリプトエディタが開いたら、このREADME.mdに記載されているGASのコード全体をコピーして貼り付けます。

2. **設定:**
   - スクリプト内の以下の設定項目を編集します。
     - `CALENDAR_IDS`: 監視したいGoogleカレンダーのIDを配列で指定します。カレンダーIDは、Googleカレンダーの設定画面から確認できます。
     - `DISCORD_WEBHOOK_URL`: 通知を送信したいDiscordチャンネルのWebhook URLを設定します。Webhookの作成方法は、Discordのヘルプドキュメントを参照してください。
     - `HOLIDAY_CALENDAR_IDS`: 祝日カレンダーのIDを設定します。日本の祝日カレンダーIDはデフォルトで設定されています。必要に応じて他の国の祝日カレンダーIDを追加できます。
     - `MESSAGE_ID_CACHE_KEY`: DiscordのメッセージIDをキャッシュに保存するためのキーです。通常は変更する必要はありません。
     - `NUM_OF_MONTHS`: 空き状況を表示する月数を設定します（当月を含む）。デフォルトは3ヶ月です。
     - `WEEK_DAYS`: 曜日の表示形式を設定します。
     - `DAYTIME_START_HOUR`, `DAYTIME_END_HOUR`: 昼間の時間帯の開始・終了時間を設定します（24時間表記）。
     - `NIGHTTIME_START_HOUR`, `NIGHTTIME_END_HOUR`: 夜間の時間帯の開始・終了時間を設定します（24時間表記）。翌日の1時など、24時を超える時間を指定できます。
     - `MIN_GAP_HOURS`: 「△」と表示するための最小の空き時間（時間単位）を設定します。
     - `WORK_SCHEDULES`: 出勤や固定の予定がある曜日と時間帯を設定します。これにより、休日・祝日ではない日の該当時間帯は自動的に「予定あり」と判定されます。

3. **権限の承認:**
   - スクリプトの実行には、Googleカレンダーへのアクセスと外部サービス（Discord）への接続の承認が必要です。スクリプトエディタの実行ボタン（▶）を押すと、承認を求められるダイアログが表示されるので、指示に従って承認してください。

4. **トリガーの設定:**
   - 定期的に空き状況をDiscordに通知するために、トリガーを設定します。
     - スクリプトエディタの左側にある時計のアイコン（トリガー）をクリックします。
     - 「トリガーを追加」ボタンをクリックします。
     - 実行する関数で `sendCalendarEventsToDiscord` を選択します。
     - イベントソースを「時間主導型」に設定し、頻度（例: 毎日、毎時など）を選択します。
     - 時間を設定し、「保存」をクリックします。

## 注意事項

- スクリプトの実行には、Googleアカウントの認証が必要です。
- DiscordのWebhook URLは、機密情報ですので、安全に管理してください。
- Googleカレンダーの予定の公開設定が「公開」または「予定あり/時間帯のみ表示」になっている必要があります。
- スクリプトの変更やGoogleのサービス仕様変更により、正常に動作しなくなる可能性があります。

## ライセンス

[MIT License](https://raw.githubusercontent.com/murahito130/Google-Calendar-to-Discord-Notifier/refs/heads/main/LICENSE)

## 開発者

[むらひと](https://github.com/murahito130)
